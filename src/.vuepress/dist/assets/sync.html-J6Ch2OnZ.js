import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as a,c as t,f as i}from"./app-uJW8EvoO.js";const n={},l=i('<h2 id="_1-mysql主从同步实现方式" tabindex="-1"><a class="header-anchor" href="#_1-mysql主从同步实现方式"><span>1. MySQL主从同步实现方式</span></a></h2><p>MySQL主从同步是基于Bin Log实现的，而Bin Log记录的是原始SQL语句。 <strong>Bin Log</strong>共有三种日志格式，可以<strong>binlog_format</strong>配置参数指定。</p><table><thead><tr><th>参数值</th><th>含义</th></tr></thead><tbody><tr><td>Statement</td><td>记录原始SQL语句，会导致更新时间与原库不一致。</td></tr><tr><td>比如 update_time=now()</td><td></td></tr><tr><td>Row</td><td>记录每行数据的变化，保证了数据与原库一致，缺点是数据量较大。</td></tr><tr><td>Mixed</td><td>Statement和Row的混合模式，默认采用Statement模式，涉及日期、函数相关的时候采用Row模式，既减少了数据量，又保证了数据一致性。</td></tr></tbody></table><p><strong>常见的主从同步架构有一主多从、双主多从。</strong><img src="https://cdn.nlark.com/yuque/0/2023/png/12651402/1686487544213-5cc24e91-28e4-41a0-b56e-1054b540e05d.png#averageHue=%23f3f2e3&amp;clientId=u5870c972-1a24-4&amp;from=paste&amp;height=540&amp;id=udd169b48&amp;originHeight=540&amp;originWidth=572&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=138116&amp;status=done&amp;style=none&amp;taskId=ufa4b93d3-9825-4864-ace4-74dbb46cb35&amp;title=&amp;width=572" alt="image-20220623221000975.png" loading="lazy"><img src="https://cdn.nlark.com/yuque/0/2023/png/12651402/1686487550666-fe0860de-0896-446f-b873-2f087203a50c.png#averageHue=%23f1efdf&amp;clientId=u5870c972-1a24-4&amp;from=paste&amp;height=536&amp;id=u22121266&amp;originHeight=536&amp;originWidth=1052&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=226528&amp;status=done&amp;style=none&amp;taskId=u77d7d84b-d03b-43b8-abe1-5315c79bb6d&amp;title=&amp;width=1052" alt="image-20220623221025652.png" loading="lazy"></p><h2 id="_2-mysql主从同步的作用" tabindex="-1"><a class="header-anchor" href="#_2-mysql主从同步的作用"><span>2. MySQL主从同步的作用</span></a></h2><ol><li>读写分离，提升数据库性能</li><li>容灾恢复，主服务器不可用时，从服务器提供服务，提高可用性</li><li>冗余备份，主服务器数据损坏丢失，从服务器保留备份</li></ol><h3 id="一主多从架构" tabindex="-1"><a class="header-anchor" href="#一主多从架构"><span>一主多从架构：</span></a></h3><p>一般是主库负责所有读写请求，而从库只负责容灾恢复和冗余备份。 如果做了读写分离的话，主库负责写请求，从库负责读请求，可以提升数据库性能。</p><h3 id="双主多从架构" tabindex="-1"><a class="header-anchor" href="#双主多从架构"><span>双主多从架构：</span></a></h3><p>一般是主库1负责所有读写请求，主库2不对外提供服务，只用来容灾恢复。 相比一主多从架构，双主多从架构可以减少宕机时间，更快恢复数据库可用状态。</p><h2 id="_3-主动同步的原理" tabindex="-1"><a class="header-anchor" href="#_3-主动同步的原理"><span>3. 主动同步的原理</span></a></h2><figure><img src="https://cdn.nlark.com/yuque/0/2023/png/12651402/1686487559310-3daa172f-dc50-4720-872e-501f513e887f.png#averageHue=%23dce8cc&amp;clientId=u5870c972-1a24-4&amp;from=paste&amp;height=946&amp;id=uee2ab33c&amp;originHeight=946&amp;originWidth=1052&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=409401&amp;status=done&amp;style=none&amp;taskId=uafe692d8-36dc-4abb-b784-2beb183bfd8&amp;title=&amp;width=1052" alt="image-20220623221744177.png" tabindex="0" loading="lazy"><figcaption>image-20220623221744177.png</figcaption></figure><ol><li>当主库数据发生变更时，写入本地Bin Log文件</li><li>从库IO线程发起dump主库Bin Log文件的请求</li><li>主库IO线程推送Bin Log文件到从库中</li><li>从库IO线程把Bin Log内容写入本地的Relay Log文件中</li><li>从库SQL线程读取Relay Log文件内容</li><li>从库SQL线程重新执行一遍SQL语句</li></ol><h2 id="_4-主从同步延迟问题" tabindex="-1"><a class="header-anchor" href="#_4-主从同步延迟问题"><span>4. 主从同步延迟问题</span></a></h2><p>主从同步最常遇到的问题就是主从同步延迟，可以通过在从库上执行<strong>show slave status</strong>命令查看延迟时间，<strong>Seconds_Behind_Master</strong>表示延迟的秒数。 <img src="https://cdn.nlark.com/yuque/0/2023/png/12651402/1686487567275-1c163217-a937-4e61-9f2b-5325ed311212.png#averageHue=%232a0c21&amp;clientId=u5870c972-1a24-4&amp;from=paste&amp;height=648&amp;id=u29eeb541&amp;originHeight=648&amp;originWidth=639&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=97789&amp;status=done&amp;style=none&amp;taskId=u8e0fecaf-9118-4585-9c2c-35fa257da5e&amp;title=&amp;width=639" alt="image-20220620230713466.png" loading="lazy"></p><h3 id="主从同步延迟的原因有哪些" tabindex="-1"><a class="header-anchor" href="#主从同步延迟的原因有哪些"><span>主从同步延迟的原因有哪些？</span></a></h3><ol><li>从库机器性能较差 主库负责所有读写请求，从库只用来备份，会用性能较差的机器，执行时间自然较慢。</li><li>从库压力更大 读写分离后，主库负责写请求，从库负责读请求。 互联网应用一般读请求更多，所以从库读压力更大，占用更多CPU资源。</li><li>网络延迟 当主库的Bin Log文件往从库上发送时，可能产生网络延迟，也会导致从库数据跟不上。</li><li>主库有大事务 当主库上有个大事务需要执行5分钟，把Bin Log文件发送到从库，从库至少也需要执行5分钟，所以这时候从库就出现了5分钟的延迟。</li></ol><h3 id="主从同步延迟的解决方案" tabindex="-1"><a class="header-anchor" href="#主从同步延迟的解决方案"><span><strong>主从同步延迟的解决方案？</strong></span></a></h3><ol><li>从库机器性能较差 把从库换成跟主库同等规格的机器。</li><li>从库压力更大 多搞几台从库，分担读请求压力。</li><li>网络延迟 联系运维或者云服务提供商解决。</li><li>主库有大事务 把大事务分割成小事务执行，大事务不但会产生从库延迟，还可能产生死锁，降低数据库并发性能，所以尽量少用大事务。</li></ol><h2 id="_5-如何提升主从同步性能" tabindex="-1"><a class="header-anchor" href="#_5-如何提升主从同步性能"><span>5. 如何提升主从同步性能</span></a></h2><h3 id="_1-从库开启多线程复制" tabindex="-1"><a class="header-anchor" href="#_1-从库开启多线程复制"><span>1. 从库开启多线程复制</span></a></h3><p>就是在主从同步的最后两步使用多线程，修改配置 <strong>slave_parallel_workers</strong>=4，代表开启4个复制线程。 <img src="https://cdn.nlark.com/yuque/0/2024/png/12651402/1710829738466-88663806-43b0-4aa1-b458-b89e780eba6e.png#averageHue=%23dce8cb&amp;clientId=u455dc75c-574e-4&amp;from=paste&amp;height=934&amp;id=u9677bbe0&amp;originHeight=934&amp;originWidth=994&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=407288&amp;status=done&amp;style=none&amp;taskId=uc74be9c9-c7e4-468c-92d2-9177d47e360&amp;title=&amp;width=994" alt="image-20220623222719256.png" loading="lazy"></p><h3 id="_2-修改同步模式-改为异步" tabindex="-1"><a class="header-anchor" href="#_2-修改同步模式-改为异步"><span>2. 修改同步模式，改为异步</span></a></h3><p><strong>主从同步共有三种复制方式：</strong></p><ol><li>全同步复制 当主库执行完一个事务，并且所有从库都执行完该事务后，才给客户端返回成功。</li><li>半同步复制 至少有一个从库执行完成后，就给客户端返回成功。</li><li>异步复制 主库执行完后，立即返回成功，不关心从库是否执行完成。</li></ol><p>如果对数据安全性要求没那么高，可以把同步模式改成半同步复制或者异步复制。</p><h3 id="_3-修改从库bin-log配置" tabindex="-1"><a class="header-anchor" href="#_3-修改从库bin-log配置"><span>3. 修改从库Bin Log配置</span></a></h3><p><strong>修改sync_binlog配置：</strong></p><blockquote><p>sync_binlog=0 ，表示写binlog不立即刷新磁盘，由系统决定什么时候刷新磁盘。 sync_binlog=1，每次写binlog都刷新磁盘，安全性高，性能差。 sync_binlog=N，写N次binlog才刷新磁盘。</p></blockquote><p>从库对数据安全性要求没那么高，可以设置sync_binlog=0。</p><p><strong>修改innodb_flush_log_at_trx_commit配置：</strong></p><blockquote><p>innodb_flush_log_at_trx_commit=0，每隔一秒钟，把事务日志刷新到磁盘。 innodb_flush_log_at_trx_commit=1，每次事务都刷新到磁盘。 innodb_flush_log_at_trx_commit=2，每次事务都不主动刷新磁盘，由系统决定什么时候刷新磁盘。</p></blockquote><p>从库对数据安全性要求没那么高，可以设置innodb_flush_log_at_trx_commit=2。</p><h2 id="知识点总结" tabindex="-1"><a class="header-anchor" href="#知识点总结"><span>知识点总结：</span></a></h2><figure><img src="https://cdn.nlark.com/yuque/0/2023/png/12651402/1686487592544-def7cc92-e93b-4003-88fb-2bf65f2e5a1a.png#averageHue=%23e7e7e7&amp;clientId=u5870c972-1a24-4&amp;from=paste&amp;height=2060&amp;id=uae3be294&amp;originHeight=2060&amp;originWidth=1956&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=306286&amp;status=done&amp;style=none&amp;taskId=u75b4a768-afbd-43ce-b60b-1cfb8ea8d20&amp;title=&amp;width=1956" alt="主从同步知识点总结.png" tabindex="0" loading="lazy"><figcaption>主从同步知识点总结.png</figcaption></figure>',35),o=[l];function s(p,r){return a(),t("div",null,o)}const c=e(n,[["render",s],["__file","sync.html.vue"]]),h=JSON.parse('{"path":"/mysql/sync.html","title":"","lang":"zh-CN","frontmatter":{"description":"1. MySQL主从同步实现方式 MySQL主从同步是基于Bin Log实现的，而Bin Log记录的是原始SQL语句。 Bin Log共有三种日志格式，可以binlog_format配置参数指定。 常见的主从同步架构有一主多从、双主多从。 image-20220623221000975.png image-20220623221025652.png ...","head":[["meta",{"property":"og:url","content":"https://vuepress-theme-hope-docs-demo.netlify.app/mysql/sync.html"}],["meta",{"property":"og:site_name","content":"Java八股文网"}],["meta",{"property":"og:description","content":"1. MySQL主从同步实现方式 MySQL主从同步是基于Bin Log实现的，而Bin Log记录的是原始SQL语句。 Bin Log共有三种日志格式，可以binlog_format配置参数指定。 常见的主从同步架构有一主多从、双主多从。 image-20220623221000975.png image-20220623221025652.png ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://cdn.nlark.com/yuque/0/2023/png/12651402/1686487544213-5cc24e91-28e4-41a0-b56e-1054b540e05d.png#averageHue=%23f3f2e3&clientId=u5870c972-1a24-4&from=paste&height=540&id=udd169b48&originHeight=540&originWidth=572&originalType=binary&ratio=1&rotation=0&showTitle=false&size=138116&status=done&style=none&taskId=ufa4b93d3-9825-4864-ace4-74dbb46cb35&title=&width=572"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:author","content":"Mr.Hope"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"\\",\\"image\\":[\\"https://cdn.nlark.com/yuque/0/2023/png/12651402/1686487544213-5cc24e91-28e4-41a0-b56e-1054b540e05d.png#averageHue=%23f3f2e3&clientId=u5870c972-1a24-4&from=paste&height=540&id=udd169b48&originHeight=540&originWidth=572&originalType=binary&ratio=1&rotation=0&showTitle=false&size=138116&status=done&style=none&taskId=ufa4b93d3-9825-4864-ace4-74dbb46cb35&title=&width=572\\",\\"https://cdn.nlark.com/yuque/0/2023/png/12651402/1686487550666-fe0860de-0896-446f-b873-2f087203a50c.png#averageHue=%23f1efdf&clientId=u5870c972-1a24-4&from=paste&height=536&id=u22121266&originHeight=536&originWidth=1052&originalType=binary&ratio=1&rotation=0&showTitle=false&size=226528&status=done&style=none&taskId=u77d7d84b-d03b-43b8-abe1-5315c79bb6d&title=&width=1052\\",\\"https://cdn.nlark.com/yuque/0/2023/png/12651402/1686487559310-3daa172f-dc50-4720-872e-501f513e887f.png#averageHue=%23dce8cc&clientId=u5870c972-1a24-4&from=paste&height=946&id=uee2ab33c&originHeight=946&originWidth=1052&originalType=binary&ratio=1&rotation=0&showTitle=false&size=409401&status=done&style=none&taskId=uafe692d8-36dc-4abb-b784-2beb183bfd8&title=&width=1052\\",\\"https://cdn.nlark.com/yuque/0/2023/png/12651402/1686487567275-1c163217-a937-4e61-9f2b-5325ed311212.png#averageHue=%232a0c21&clientId=u5870c972-1a24-4&from=paste&height=648&id=u29eeb541&originHeight=648&originWidth=639&originalType=binary&ratio=1&rotation=0&showTitle=false&size=97789&status=done&style=none&taskId=u8e0fecaf-9118-4585-9c2c-35fa257da5e&title=&width=639\\",\\"https://cdn.nlark.com/yuque/0/2024/png/12651402/1710829738466-88663806-43b0-4aa1-b458-b89e780eba6e.png#averageHue=%23dce8cb&clientId=u455dc75c-574e-4&from=paste&height=934&id=u9677bbe0&originHeight=934&originWidth=994&originalType=binary&ratio=1&rotation=0&showTitle=false&size=407288&status=done&style=none&taskId=uc74be9c9-c7e4-468c-92d2-9177d47e360&title=&width=994\\",\\"https://cdn.nlark.com/yuque/0/2023/png/12651402/1686487592544-def7cc92-e93b-4003-88fb-2bf65f2e5a1a.png#averageHue=%23e7e7e7&clientId=u5870c972-1a24-4&from=paste&height=2060&id=uae3be294&originHeight=2060&originWidth=1956&originalType=binary&ratio=1&rotation=0&showTitle=false&size=306286&status=done&style=none&taskId=u75b4a768-afbd-43ce-b60b-1cfb8ea8d20&title=&width=1956\\"],\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Mr.Hope\\",\\"url\\":\\"https://mister-hope.com\\"}]}"]]},"headers":[{"level":2,"title":"1. MySQL主从同步实现方式","slug":"_1-mysql主从同步实现方式","link":"#_1-mysql主从同步实现方式","children":[]},{"level":2,"title":"2. MySQL主从同步的作用","slug":"_2-mysql主从同步的作用","link":"#_2-mysql主从同步的作用","children":[{"level":3,"title":"一主多从架构：","slug":"一主多从架构","link":"#一主多从架构","children":[]},{"level":3,"title":"双主多从架构：","slug":"双主多从架构","link":"#双主多从架构","children":[]}]},{"level":2,"title":"3. 主动同步的原理","slug":"_3-主动同步的原理","link":"#_3-主动同步的原理","children":[]},{"level":2,"title":"4. 主从同步延迟问题","slug":"_4-主从同步延迟问题","link":"#_4-主从同步延迟问题","children":[{"level":3,"title":"主从同步延迟的原因有哪些？","slug":"主从同步延迟的原因有哪些","link":"#主从同步延迟的原因有哪些","children":[]},{"level":3,"title":"主从同步延迟的解决方案？","slug":"主从同步延迟的解决方案","link":"#主从同步延迟的解决方案","children":[]}]},{"level":2,"title":"5. 如何提升主从同步性能","slug":"_5-如何提升主从同步性能","link":"#_5-如何提升主从同步性能","children":[{"level":3,"title":"1. 从库开启多线程复制","slug":"_1-从库开启多线程复制","link":"#_1-从库开启多线程复制","children":[]},{"level":3,"title":"2. 修改同步模式，改为异步","slug":"_2-修改同步模式-改为异步","link":"#_2-修改同步模式-改为异步","children":[]},{"level":3,"title":"3. 修改从库Bin Log配置","slug":"_3-修改从库bin-log配置","link":"#_3-修改从库bin-log配置","children":[]}]},{"level":2,"title":"知识点总结：","slug":"知识点总结","link":"#知识点总结","children":[]}],"git":{"createdTime":null,"updatedTime":null,"contributors":[]},"readingTime":{"minutes":5.23,"words":1569},"filePathRelative":"mysql/sync.md","autoDesc":true}');export{c as comp,h as data};
